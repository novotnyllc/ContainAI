# ContainAI Sync Manifest
# Single source of truth for config sync between host and container
#
# This manifest defines:
# - What gets synced from host $HOME to the data volume
# - What symlinks are created in the container image
# - What directory structure is initialized on first boot
#
# Flags:
#   f = file
#   d = directory
#   j = json-init (create {} if empty)
#   s = secret (600 for files, 700 for dirs)
#   m = mirror mode (--delete to remove files not in source)
#   x = exclude .system/ subdirectory
#   g = git-filter (strip credential.helper) - for future use
#   R = remove existing path first (rm -rf before ln -sfn)
#
# Fields:
#   source = path relative to $HOME (includes leading dot, e.g., ".claude.json")
#   target = path relative to /mnt/agent-data (volume)
#   container_link = path relative to ~ where symlink is created (optional)
#   flags = combination of flags above

# =============================================================================
# CLAUDE CODE
# =============================================================================

[[entries]]
source = ".claude.json"
target = "claude/claude.json"
container_link = ".claude.json"
flags = "fjs"  # file, json-init, secret

[[entries]]
source = ".claude/.credentials.json"
target = "claude/credentials.json"
container_link = ".claude/.credentials.json"
flags = "fs"  # file, secret

[[entries]]
source = ".claude/settings.json"
target = "claude/settings.json"
container_link = ".claude/settings.json"
flags = "fj"  # file, json-init

[[entries]]
source = ".claude/settings.local.json"
target = "claude/settings.local.json"
container_link = ".claude/settings.local.json"
flags = "f"  # file

[[entries]]
source = ".claude/plugins"
target = "claude/plugins"
container_link = ".claude/plugins"
flags = "d"  # directory

[[entries]]
source = ".claude/skills"
target = "claude/skills"
container_link = ".claude/skills"
flags = "d"  # directory

[[entries]]
source = ".claude/commands"
target = "claude/commands"
container_link = ".claude/commands"
flags = "d"  # directory

[[entries]]
source = ".claude/agents"
target = "claude/agents"
container_link = ".claude/agents"
flags = "d"  # directory

[[entries]]
source = ".claude/hooks"
target = "claude/hooks"
container_link = ".claude/hooks"
flags = "d"  # directory

[[entries]]
source = ".claude/CLAUDE.md"
target = "claude/CLAUDE.md"
container_link = ".claude/CLAUDE.md"
flags = "f"  # file

# =============================================================================
# GITHUB CLI
# Only hosts.yml is secret (contains OAuth tokens)
# Other GH config files (config.yml, etc.) are not secrets
# =============================================================================

[[entries]]
source = ".config/gh/hosts.yml"
target = "config/gh/hosts.yml"
container_link = ".config/gh/hosts.yml"
flags = "fs"  # file, secret (contains OAuth tokens)

[[entries]]
source = ".config/gh/config.yml"
target = "config/gh/config.yml"
container_link = ".config/gh/config.yml"
flags = "f"  # file (not secret - user preferences only)

# =============================================================================
# SSH
# Non-secret files: config, known_hosts (static entries)
# Secret files: private keys (id_*) - discovered dynamically at import time
# See _import_discover_ssh_keys() in import.sh for dynamic key discovery
# =============================================================================

[[entries]]
source = ".ssh/config"
target = "ssh/config"
container_link = ".ssh/config"
flags = "f"  # file (not secret - SSH config is public)

[[entries]]
source = ".ssh/known_hosts"
target = "ssh/known_hosts"
container_link = ".ssh/known_hosts"
flags = "f"  # file (not secret - host keys are public)

# Note: SSH private keys (id_*) and their .pub counterparts are discovered
# dynamically at import time. This allows syncing any key naming pattern
# (id_rsa, id_ed25519, id_ed25519_sk, id_rsa_work, etc.)
# Private keys (files without .pub extension matching id_*) get 's' flag.
# Public keys (*.pub) do not get 's' flag.

# =============================================================================
# OPENCODE
# Selective sync: config files only, skip caches
# opencode.json may contain API keys/tokens
# =============================================================================

[[entries]]
source = ".config/opencode/opencode.json"
target = "config/opencode/opencode.json"
container_link = ".config/opencode/opencode.json"
flags = "fjs"  # file, JSON init, secret

[[entries]]
source = ".config/opencode/agents"
target = "config/opencode/agents"
container_link = ".config/opencode/agents"
flags = "d"  # directory

[[entries]]
source = ".config/opencode/commands"
target = "config/opencode/commands"
container_link = ".config/opencode/commands"
flags = "d"  # directory

[[entries]]
source = ".config/opencode/skills"
target = "config/opencode/skills"
container_link = ".config/opencode/skills"
flags = "d"  # directory

[[entries]]
source = ".config/opencode/modes"
target = "config/opencode/modes"
container_link = ".config/opencode/modes"
flags = "d"  # directory

[[entries]]
source = ".config/opencode/plugins"
target = "config/opencode/plugins"
container_link = ".config/opencode/plugins"
flags = "d"  # directory

[[entries]]
source = ".config/opencode/instructions.md"
target = "config/opencode/instructions.md"
container_link = ".config/opencode/instructions.md"
flags = "f"  # file

[[entries]]
source = ".local/share/opencode/auth.json"
target = "local/share/opencode/auth.json"
container_link = ".local/share/opencode/auth.json"
flags = "fs"  # file, secret

# =============================================================================
# TMUX
# XDG precedence: legacy ~/.tmux.conf syncs first as fallback, then XDG
# ~/.config/tmux/ overwrites. This ensures XDG wins when both exist.
# =============================================================================

[[entries]]
source = ".tmux.conf"
target = "config/tmux/tmux.conf"
container_link = ""  # No direct symlink - file is inside config/tmux dir
flags = "f"  # file (fallback for legacy users)

[[entries]]
source = ".config/tmux"
target = "config/tmux"
container_link = ".config/tmux"
flags = "d"  # directory (XDG, preferred)

[[entries]]
source = ".local/share/tmux"
target = "local/share/tmux"
container_link = ".local/share/tmux"
flags = "d"  # directory

# =============================================================================
# FONTS
# =============================================================================

[[entries]]
source = ".local/share/fonts"
target = "local/share/fonts"
container_link = ".local/share/fonts"
flags = "d"  # directory

# =============================================================================
# COMMON AGENTS DIRECTORY
# =============================================================================

[[entries]]
source = ".agents"
target = "agents"
container_link = ".agents"
flags = "d"  # directory

# =============================================================================
# SHELL
# =============================================================================

[[entries]]
source = ".bash_aliases"
target = "shell/bash_aliases"
container_link = ".bash_aliases_imported"  # Different name to preserve user's original
flags = "f"  # file

[[entries]]
source = ".bashrc.d"
target = "shell/bashrc.d"
container_link = ""  # Sourced via .bashrc hook, not directly symlinked
flags = "d"  # directory

[[entries]]
source = ".zshrc"
target = "shell/zshrc"
container_link = ".zshrc"
flags = "f"  # file

[[entries]]
source = ".zprofile"
target = "shell/zprofile"
container_link = ".zprofile"
flags = "f"  # file

[[entries]]
source = ".inputrc"
target = "shell/inputrc"
container_link = ".inputrc"
flags = "f"  # file

[[entries]]
source = ".oh-my-zsh/custom"
target = "shell/oh-my-zsh-custom"
container_link = ".oh-my-zsh/custom"
flags = "dR"  # directory, remove existing first (may be pre-populated)

# =============================================================================
# EDITORS (VIM / NEOVIM)
# =============================================================================

[[entries]]
source = ".vimrc"
target = "editors/vimrc"
container_link = ".vimrc"
flags = "f"  # file

[[entries]]
source = ".vim"
target = "editors/vim"
container_link = ".vim"
flags = "dR"  # directory, remove existing first

[[entries]]
source = ".config/nvim"
target = "config/nvim"
container_link = ".config/nvim"
flags = "dR"  # directory, remove existing first

# =============================================================================
# PROMPT CUSTOMIZATION
# =============================================================================

[[entries]]
source = ".config/starship.toml"
target = "config/starship.toml"
container_link = ".config/starship.toml"
flags = "f"  # file

[[entries]]
source = ".config/oh-my-posh"
target = "config/oh-my-posh"
container_link = ".config/oh-my-posh"
flags = "d"  # directory

# =============================================================================
# VS CODE SERVER (STABLE)
# =============================================================================

[[entries]]
source = ".vscode-server/extensions"
target = "vscode-server/extensions"
container_link = ".vscode-server/extensions"
flags = "d"  # directory

[[entries]]
source = ".vscode-server/data/Machine"
target = "vscode-server/data/Machine"
container_link = ""  # Only settings.json is symlinked, not the whole dir
flags = "d"  # directory

[[entries]]
source = ".vscode-server/data/User/mcp"
target = "vscode-server/data/User/mcp"
container_link = ".vscode-server/data/User/mcp"
flags = "d"  # directory

[[entries]]
source = ".vscode-server/data/User/prompts"
target = "vscode-server/data/User/prompts"
container_link = ".vscode-server/data/User/prompts"
flags = "d"  # directory

# =============================================================================
# VS CODE SERVER (INSIDERS)
# =============================================================================

[[entries]]
source = ".vscode-server-insiders/extensions"
target = "vscode-server-insiders/extensions"
container_link = ".vscode-server-insiders/extensions"
flags = "d"  # directory

[[entries]]
source = ".vscode-server-insiders/data/Machine"
target = "vscode-server-insiders/data/Machine"
container_link = ""  # Only settings.json is symlinked, not the whole dir
flags = "d"  # directory

[[entries]]
source = ".vscode-server-insiders/data/User/mcp"
target = "vscode-server-insiders/data/User/mcp"
container_link = ".vscode-server-insiders/data/User/mcp"
flags = "d"  # directory

[[entries]]
source = ".vscode-server-insiders/data/User/prompts"
target = "vscode-server-insiders/data/User/prompts"
container_link = ".vscode-server-insiders/data/User/prompts"
flags = "d"  # directory

# =============================================================================
# COPILOT
# =============================================================================

[[entries]]
source = ".copilot/config.json"
target = "copilot/config.json"
container_link = ".copilot/config.json"
flags = "f"  # file

[[entries]]
source = ".copilot/mcp-config.json"
target = "copilot/mcp-config.json"
container_link = ".copilot/mcp-config.json"
flags = "f"  # file

[[entries]]
source = ".copilot/skills"
target = "copilot/skills"
container_link = ".copilot/skills"
flags = "dR"  # directory, remove existing first

# =============================================================================
# GEMINI
# =============================================================================

[[entries]]
source = ".gemini/google_accounts.json"
target = "gemini/google_accounts.json"
container_link = ".gemini/google_accounts.json"
flags = "fs"  # file, secret

[[entries]]
source = ".gemini/oauth_creds.json"
target = "gemini/oauth_creds.json"
container_link = ".gemini/oauth_creds.json"
flags = "fs"  # file, secret

[[entries]]
source = ".gemini/settings.json"
target = "gemini/settings.json"
container_link = ".gemini/settings.json"
flags = "fj"  # file, json-init

[[entries]]
source = ".gemini/GEMINI.md"
target = "gemini/GEMINI.md"
container_link = ".gemini/GEMINI.md"
flags = "f"  # file

# =============================================================================
# CODEX
# =============================================================================

[[entries]]
source = ".codex/config.toml"
target = "codex/config.toml"
container_link = ".codex/config.toml"
flags = "f"  # file

[[entries]]
source = ".codex/auth.json"
target = "codex/auth.json"
container_link = ".codex/auth.json"
flags = "fs"  # file, secret

[[entries]]
source = ".codex/skills"
target = "codex/skills"
container_link = ".codex/skills"
flags = "dxR"  # directory, exclude .system/, remove existing first

# =============================================================================
# AIDER
# Simple config files (no directory structure)
# May contain API keys (openai-api-key, etc.)
# =============================================================================

[[entries]]
source = ".aider.conf.yml"
target = "aider/aider.conf.yml"
container_link = ".aider.conf.yml"
flags = "fs"  # file, secret

[[entries]]
source = ".aider.model.settings.yml"
target = "aider/aider.model.settings.yml"
container_link = ".aider.model.settings.yml"
flags = "fs"  # file, secret

# =============================================================================
# CONTINUE
# Selective sync: config files only, skip sessions/index
# May contain API keys/tokens
# =============================================================================

[[entries]]
source = ".continue/config.yaml"
target = "continue/config.yaml"
container_link = ".continue/config.yaml"
flags = "fs"  # file, secret

[[entries]]
source = ".continue/config.json"
target = "continue/config.json"
container_link = ".continue/config.json"
flags = "fjs"  # file, JSON init, secret

# =============================================================================
# CURSOR
# Selective sync: mcp.json, rules, extensions
# mcp.json may contain API keys/tokens
# =============================================================================

[[entries]]
source = ".cursor/mcp.json"
target = "cursor/mcp.json"
container_link = ".cursor/mcp.json"
flags = "fjs"  # file, JSON init, secret

[[entries]]
source = ".cursor/rules"
target = "cursor/rules"
container_link = ".cursor/rules"
flags = "d"  # directory

[[entries]]
source = ".cursor/extensions"
target = "cursor/extensions"
container_link = ".cursor/extensions"
flags = "d"  # directory

# =============================================================================
# ADDITIONAL SYMLINKS (container-only, no host import)
# These are created in the Dockerfile but have no corresponding import entry
# =============================================================================

# VS Code Machine settings.json symlinks (the directory is imported, but
# only the settings.json file is symlinked individually)
# container_link_only entries have empty source

[[container_symlinks]]
target = "vscode-server/data/Machine/settings.json"
container_link = ".vscode-server/data/Machine/settings.json"
flags = "fj"

[[container_symlinks]]
target = "vscode-server/data/User/mcp.json"
container_link = ".vscode-server/data/User/mcp.json"
flags = "fj"

[[container_symlinks]]
target = "vscode-server-insiders/data/Machine/settings.json"
container_link = ".vscode-server-insiders/data/Machine/settings.json"
flags = "fj"

[[container_symlinks]]
target = "vscode-server-insiders/data/User/mcp.json"
container_link = ".vscode-server-insiders/data/User/mcp.json"
flags = "fj"
