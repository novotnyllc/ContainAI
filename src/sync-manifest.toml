# ContainAI Sync Manifest
# ==============================================================================
# AUTHORITATIVE SOURCE: This file is the single source of truth for config sync.
# ==============================================================================
#
# If you modify this manifest, also update _IMPORT_SYNC_MAP in src/lib/import.sh.
# Run `scripts/check-manifest-consistency.sh` to verify alignment.
# CI enforces consistency between this manifest and the import map.
#
# This manifest defines:
# - What gets synced from host $HOME to the data volume
# - What symlinks are created in the container image
# - What directory structure is initialized on first boot
#
# Flags:
#   f = file
#   d = directory
#   j = json-init (create {} if empty)
#   s = secret (600 for files, 700 for dirs; skipped with --no-secrets)
#   m = mirror mode (--delete to remove files not in source)
#   x = exclude .system/ subdirectory
#   g = git-filter (strip credential.helper and signing config from .gitconfig)
#   R = remove existing path first (rm -rf before ln -sfn)
#   G = glob/dynamic pattern (not synced directly; discovered at runtime by import.sh)
#   o = optional (skip if source doesn't exist; don't pre-create in Dockerfile/init)
#
# Optional fields:
#   disabled = true  # Entry excluded from _IMPORT_SYNC_MAP (not synced by default)
#                    # but still generates symlinks/init (for use with additional_paths)
#
# Fields:
#   source = path relative to $HOME (includes leading dot, e.g., ".claude.json")
#   target = path relative to /mnt/agent-data (volume)
#   container_link = path relative to ~ where symlink is created (optional)
#   flags = combination of flags above

# =============================================================================
# CLAUDE CODE
# =============================================================================

[[entries]]
source = ".claude.json"
target = "claude/claude.json"
container_link = ".claude.json"
flags = "fjs"  # file, json-init, secret

[[entries]]
source = ".claude/.credentials.json"
target = "claude/credentials.json"
container_link = ".claude/.credentials.json"
flags = "fs"  # file, secret

[[entries]]
source = ".claude/settings.json"
target = "claude/settings.json"
container_link = ".claude/settings.json"
flags = "fj"  # file, json-init

[[entries]]
source = ".claude/settings.local.json"
target = "claude/settings.local.json"
container_link = ".claude/settings.local.json"
flags = "f"  # file

[[entries]]
source = ".claude/plugins"
target = "claude/plugins"
container_link = ".claude/plugins"
flags = "dR"  # directory, remove existing first

[[entries]]
source = ".claude/skills"
target = "claude/skills"
container_link = ".claude/skills"
flags = "dR"  # directory, remove existing first

[[entries]]
source = ".claude/commands"
target = "claude/commands"
container_link = ".claude/commands"
flags = "dR"  # directory, remove existing first

[[entries]]
source = ".claude/agents"
target = "claude/agents"
container_link = ".claude/agents"
flags = "dR"  # directory, remove existing first

[[entries]]
source = ".claude/hooks"
target = "claude/hooks"
container_link = ".claude/hooks"
flags = "dR"  # directory, remove existing first

[[entries]]
source = ".claude/CLAUDE.md"
target = "claude/CLAUDE.md"
container_link = ".claude/CLAUDE.md"
flags = "f"  # file

# =============================================================================
# GITHUB CLI
# hosts.yml contains OAuth tokens (secret)
# Other files (config.yml, etc.) are not secrets
# =============================================================================

[[entries]]
source = ".config/gh/hosts.yml"
target = "config/gh/hosts.yml"
container_link = ".config/gh/hosts.yml"
flags = "fs"  # file, secret (OAuth tokens)

[[entries]]
source = ".config/gh/config.yml"
target = "config/gh/config.yml"
container_link = ".config/gh/config.yml"
flags = "f"  # file (user preferences, not secret)

# Note: Container Dockerfile symlinks entire .config/gh directory.
# The individual file entries here ensure --no-secrets only skips hosts.yml.

# =============================================================================
# GIT
# .gitconfig: filtered to strip credential.helper and signing config (g flag)
#   - Stored in git/gitconfig, symlinked to ~/.gitconfig
#   - Changes inside container persist across restarts
# .gitignore_global: synced as-is (no filtering)
# =============================================================================

[[entries]]
source = ".gitconfig"
target = "git/gitconfig"
container_link = ".gitconfig"
flags = "fg"  # file, git-filter (strip credential.helper and signing config)

[[entries]]
source = ".gitignore_global"
target = "git/gitignore_global"
container_link = ".gitignore_global"
flags = "f"  # file

# =============================================================================
# SSH
# NOTE: SSH is NOT imported by default for security reasons.
# Users who need SSH keys in containers should add ~/.ssh to
# [import].additional_paths in containai.toml.
# Agent forwarding (ssh -A) is the preferred approach.
#
# These entries document the link structure but are NOT in _IMPORT_SYNC_MAP.
# If users add ~/.ssh via additional_paths, these links will be created.
# =============================================================================

[[entries]]
source = ".ssh/config"
target = "ssh/config"
container_link = ".ssh/config"
flags = "f"  # file (not secret - SSH config is public)
disabled = true  # Not imported by default; add via additional_paths if needed

[[entries]]
source = ".ssh/known_hosts"
target = "ssh/known_hosts"
container_link = ".ssh/known_hosts"
flags = "f"  # file (not secret - host keys are public)
disabled = true  # Not imported by default; add via additional_paths if needed

# SSH private keys pattern (for reference only)
# If users add ~/.ssh via additional_paths, all files including keys are synced.
# additional_paths are NOT marked as secrets, so --no-secrets won't skip them.
[[entries]]
source = ".ssh/id_*"
target = "ssh/"
container_link = ".ssh/"
flags = "Gs"  # G=glob/dynamic pattern, s=secret (private keys)
disabled = true  # Not imported by default; add via additional_paths if needed

# =============================================================================
# OPENCODE
# Selective sync: config files only, skip caches
# opencode.json may contain API keys/tokens
# =============================================================================

[[entries]]
source = ".config/opencode/opencode.json"
target = "config/opencode/opencode.json"
container_link = ".config/opencode/opencode.json"
flags = "fjs"  # file, JSON init, secret

[[entries]]
source = ".config/opencode/agents"
target = "config/opencode/agents"
container_link = ".config/opencode/agents"
flags = "d"  # directory

[[entries]]
source = ".config/opencode/commands"
target = "config/opencode/commands"
container_link = ".config/opencode/commands"
flags = "d"  # directory

[[entries]]
source = ".config/opencode/skills"
target = "config/opencode/skills"
container_link = ".config/opencode/skills"
flags = "d"  # directory

[[entries]]
source = ".config/opencode/modes"
target = "config/opencode/modes"
container_link = ".config/opencode/modes"
flags = "d"  # directory

[[entries]]
source = ".config/opencode/plugins"
target = "config/opencode/plugins"
container_link = ".config/opencode/plugins"
flags = "d"  # directory

[[entries]]
source = ".config/opencode/instructions.md"
target = "config/opencode/instructions.md"
container_link = ".config/opencode/instructions.md"
flags = "f"  # file

[[entries]]
source = ".local/share/opencode/auth.json"
target = "local/share/opencode/auth.json"
container_link = ".local/share/opencode/auth.json"
flags = "fs"  # file, secret

# =============================================================================
# TMUX
# XDG precedence: legacy ~/.tmux.conf syncs first as fallback, then XDG
# ~/.config/tmux/ overwrites. This ensures XDG wins when both exist.
# =============================================================================

[[entries]]
source = ".tmux.conf"
target = "config/tmux/tmux.conf"
container_link = ""  # No direct symlink - file is inside config/tmux dir
flags = "f"  # file (fallback for legacy users)

[[entries]]
source = ".config/tmux"
target = "config/tmux"
container_link = ".config/tmux"
flags = "d"  # directory (XDG, preferred)

[[entries]]
source = ".local/share/tmux"
target = "local/share/tmux"
container_link = ".local/share/tmux"
flags = "d"  # directory

# =============================================================================
# FONTS
# =============================================================================

[[entries]]
source = ".local/share/fonts"
target = "local/share/fonts"
container_link = ".local/share/fonts"
flags = "d"  # directory

# =============================================================================
# COMMON AGENTS DIRECTORY
# =============================================================================

[[entries]]
source = ".agents"
target = "agents"
container_link = ".agents"
flags = "d"  # directory

# =============================================================================
# SHELL
# =============================================================================

[[entries]]
source = ".bash_aliases"
target = "shell/bash_aliases"
container_link = ".bash_aliases_imported"  # Different name to preserve user's original
flags = "fR"  # file, remove existing first (Dockerfile uses rm -rf before ln)

[[entries]]
source = ".bashrc.d"
target = "shell/bashrc.d"
container_link = ""  # Sourced via .bashrc hook, not directly symlinked
flags = "dp"  # directory, exclude *.priv.* files (security)

[[entries]]
source = ".zshrc"
target = "shell/zshrc"
container_link = ".zshrc"
flags = "f"  # file

[[entries]]
source = ".zprofile"
target = "shell/zprofile"
container_link = ".zprofile"
flags = "f"  # file

[[entries]]
source = ".zshenv"
target = "shell/zshenv"
container_link = ".zshenv"
flags = "f"  # file

[[entries]]
source = ".inputrc"
target = "shell/inputrc"
container_link = ".inputrc"
flags = "f"  # file

[[entries]]
source = ".oh-my-zsh/custom"
target = "shell/oh-my-zsh-custom"
container_link = ".oh-my-zsh/custom"
flags = "dR"  # directory, remove existing first (may be pre-populated)

# =============================================================================
# EDITORS (VIM / NEOVIM)
# =============================================================================

[[entries]]
source = ".vimrc"
target = "editors/vimrc"
container_link = ".vimrc"
flags = "f"  # file

[[entries]]
source = ".vim"
target = "editors/vim"
container_link = ".vim"
flags = "dR"  # directory, remove existing first

[[entries]]
source = ".config/nvim"
target = "config/nvim"
container_link = ".config/nvim"
flags = "dR"  # directory, remove existing first

# =============================================================================
# PROMPT CUSTOMIZATION
# =============================================================================

[[entries]]
source = ".config/starship.toml"
target = "config/starship.toml"
container_link = ".config/starship.toml"
flags = "f"  # file

[[entries]]
source = ".config/oh-my-posh"
target = "config/oh-my-posh"
container_link = ".config/oh-my-posh"
flags = "dR"  # directory, remove existing first

# =============================================================================
# VS CODE SERVER (STABLE)
# =============================================================================

[[entries]]
source = ".vscode-server/extensions"
target = "vscode-server/extensions"
container_link = ".vscode-server/extensions"
flags = "d"  # directory

[[entries]]
source = ".vscode-server/data/Machine"
target = "vscode-server/data/Machine"
container_link = ""  # Only settings.json is symlinked, not the whole dir
flags = "d"  # directory

[[entries]]
source = ".vscode-server/data/User/mcp"
target = "vscode-server/data/User/mcp"
container_link = ".vscode-server/data/User/mcp"
flags = "d"  # directory

[[entries]]
source = ".vscode-server/data/User/prompts"
target = "vscode-server/data/User/prompts"
container_link = ".vscode-server/data/User/prompts"
flags = "d"  # directory

# =============================================================================
# VS CODE SERVER (INSIDERS)
# =============================================================================

[[entries]]
source = ".vscode-server-insiders/extensions"
target = "vscode-server-insiders/extensions"
container_link = ".vscode-server-insiders/extensions"
flags = "d"  # directory

[[entries]]
source = ".vscode-server-insiders/data/Machine"
target = "vscode-server-insiders/data/Machine"
container_link = ""  # Only settings.json is symlinked, not the whole dir
flags = "d"  # directory

[[entries]]
source = ".vscode-server-insiders/data/User/mcp"
target = "vscode-server-insiders/data/User/mcp"
container_link = ".vscode-server-insiders/data/User/mcp"
flags = "d"  # directory

[[entries]]
source = ".vscode-server-insiders/data/User/prompts"
target = "vscode-server-insiders/data/User/prompts"
container_link = ".vscode-server-insiders/data/User/prompts"
flags = "d"  # directory

# =============================================================================
# COPILOT (optional - only sync if user has it configured)
# =============================================================================

[[entries]]
source = ".copilot/config.json"
target = "copilot/config.json"
container_link = ".copilot/config.json"
flags = "fo"  # file, optional

[[entries]]
source = ".copilot/mcp-config.json"
target = "copilot/mcp-config.json"
container_link = ".copilot/mcp-config.json"
flags = "fo"  # file, optional

[[entries]]
source = ".copilot/skills"
target = "copilot/skills"
container_link = ".copilot/skills"
flags = "dRo"  # directory, remove existing first, optional

# =============================================================================
# GEMINI (optional - only sync if user has it configured)
# =============================================================================

[[entries]]
source = ".gemini/google_accounts.json"
target = "gemini/google_accounts.json"
container_link = ".gemini/google_accounts.json"
flags = "fso"  # file, secret, optional

[[entries]]
source = ".gemini/oauth_creds.json"
target = "gemini/oauth_creds.json"
container_link = ".gemini/oauth_creds.json"
flags = "fso"  # file, secret, optional

[[entries]]
source = ".gemini/settings.json"
target = "gemini/settings.json"
container_link = ".gemini/settings.json"
flags = "fjo"  # file, json-init, optional

[[entries]]
source = ".gemini/GEMINI.md"
target = "gemini/GEMINI.md"
container_link = ".gemini/GEMINI.md"
flags = "fo"  # file, optional

# =============================================================================
# CODEX
# =============================================================================

[[entries]]
source = ".codex/config.toml"
target = "codex/config.toml"
container_link = ".codex/config.toml"
flags = "f"  # file

[[entries]]
source = ".codex/auth.json"
target = "codex/auth.json"
container_link = ".codex/auth.json"
flags = "fs"  # file, secret

[[entries]]
source = ".codex/skills"
target = "codex/skills"
container_link = ".codex/skills"
flags = "dxR"  # directory, exclude .system/, remove existing first

# =============================================================================
# AIDER (optional - only sync if user has it configured)
# Simple config files (no directory structure)
# May contain API keys (openai-api-key, etc.)
# =============================================================================

[[entries]]
source = ".aider.conf.yml"
target = "aider/aider.conf.yml"
container_link = ".aider.conf.yml"
flags = "fso"  # file, secret, optional

[[entries]]
source = ".aider.model.settings.yml"
target = "aider/aider.model.settings.yml"
container_link = ".aider.model.settings.yml"
flags = "fso"  # file, secret, optional

# =============================================================================
# CONTINUE (optional - only sync if user has it configured)
# Selective sync: config files only, skip sessions/index
# May contain API keys/tokens
# =============================================================================

[[entries]]
source = ".continue/config.yaml"
target = "continue/config.yaml"
container_link = ".continue/config.yaml"
flags = "fso"  # file, secret, optional

[[entries]]
source = ".continue/config.json"
target = "continue/config.json"
container_link = ".continue/config.json"
flags = "fjso"  # file, JSON init, secret, optional

# =============================================================================
# CURSOR (optional - only sync if user has it configured)
# Selective sync: mcp.json, rules, extensions
# mcp.json may contain API keys/tokens
# =============================================================================

[[entries]]
source = ".cursor/mcp.json"
target = "cursor/mcp.json"
container_link = ".cursor/mcp.json"
flags = "fjso"  # file, JSON init, secret, optional

[[entries]]
source = ".cursor/rules"
target = "cursor/rules"
container_link = ".cursor/rules"
flags = "dRo"  # directory, remove existing first, optional

[[entries]]
source = ".cursor/extensions"
target = "cursor/extensions"
container_link = ".cursor/extensions"
flags = "dRo"  # directory, remove existing first, optional

# =============================================================================
# PI (Mario Zechner's pi-coding-agent) - Optional
# Config location: ~/.pi/agent/
# Docs: https://github.com/badlogic/pi-mono
# =============================================================================

[[entries]]
source = ".pi/agent/settings.json"
target = "pi/settings.json"
container_link = ".pi/agent/settings.json"
flags = "fjo"  # file, json-init, optional

[[entries]]
source = ".pi/agent/models.json"
target = "pi/models.json"
container_link = ".pi/agent/models.json"
flags = "fjso"  # file, json-init, SECRET, optional

[[entries]]
source = ".pi/agent/keybindings.json"
target = "pi/keybindings.json"
container_link = ".pi/agent/keybindings.json"
flags = "fjo"  # file, json-init, optional

[[entries]]
source = ".pi/agent/skills"
target = "pi/skills"
container_link = ".pi/agent/skills"
flags = "dxRo"  # directory, exclude .system/, remove-first, optional

[[entries]]
source = ".pi/agent/extensions"
target = "pi/extensions"
container_link = ".pi/agent/extensions"
flags = "dRo"  # directory, remove-first, optional

# =============================================================================
# KIMI CLI (MoonshotAI) - Optional
# Config location: ~/.kimi/
# Docs: https://github.com/MoonshotAI/kimi-cli
# =============================================================================

[[entries]]
source = ".kimi/config.toml"
target = "kimi/config.toml"
container_link = ".kimi/config.toml"
flags = "fso"  # file, SECRET, optional

[[entries]]
source = ".kimi/mcp.json"
target = "kimi/mcp.json"
container_link = ".kimi/mcp.json"
flags = "fjso"  # file, json-init, SECRET, optional

# =============================================================================
# ADDITIONAL SYMLINKS (container-only, no host import)
# These are created in the Dockerfile but have no corresponding import entry
# =============================================================================

# VS Code Machine settings.json symlinks (the directory is imported, but
# only the settings.json file is symlinked individually)
# container_link_only entries have empty source

[[container_symlinks]]
target = "vscode-server/data/Machine/settings.json"
container_link = ".vscode-server/data/Machine/settings.json"
flags = "fj"

[[container_symlinks]]
target = "vscode-server/data/User/mcp.json"
container_link = ".vscode-server/data/User/mcp.json"
flags = "fj"

[[container_symlinks]]
target = "vscode-server-insiders/data/Machine/settings.json"
container_link = ".vscode-server-insiders/data/Machine/settings.json"
flags = "fj"

[[container_symlinks]]
target = "vscode-server-insiders/data/User/mcp.json"
container_link = ".vscode-server-insiders/data/User/mcp.json"
flags = "fj"
