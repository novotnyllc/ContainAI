{
  "created_at": "2026-02-01T19:51:06.197801Z",
  "epic": {
    "data": {
      "branch_name": "fn-37-4xi",
      "created_at": "2026-01-28T19:11:00.398775Z",
      "depends_on_epics": [
        "fn-35-e0x"
      ],
      "id": "fn-37-4xi",
      "next_task": 1,
      "plan_review_status": "unknown",
      "plan_reviewed_at": null,
      "spec_path": ".flow/specs/fn-37-4xi.md",
      "status": "open",
      "title": "Base Image Contract Documentation",
      "updated_at": "2026-01-28T19:47:44.156564Z"
    },
    "spec": "# fn-37-4xi Base Image Contract Documentation\n\n## Overview\n\nDocument what ContainAI expects from base images. This helps users who want to create custom images or understand the system architecture.\n\n**Priority:** LAST - Do this after all other epics are stable.\n\n## Scope\n\n### In Scope\n- Create `docs/base-image-contract.md`\n- Document required filesystem layout\n- Document required user configuration\n- Document required services (systemd, sshd, dockerd)\n- Document entrypoint requirements (MUST NOT override)\n- Document recommended SDKs and agents\n- Document layer validation behavior\n\n### Out of Scope\n- Automated validation tooling (just documentation)\n- Custom image building scripts\n\n## Approach\n\n### Base Image Contract Document\n\nCreate `docs/base-image-contract.md`:\n\n```markdown\n# ContainAI Base Image Contract\n\nThis document describes what ContainAI expects from base images.\n\n## Required\n\n### Filesystem Layout\n- `/home/agent` - Agent user home directory\n- `/mnt/agent-data` - Mount point for data volume\n- `/opt/containai` - ContainAI scripts and tools\n\n### User\n- `agent` user (UID 1000) with passwordless sudo\n- Home directory at `/home/agent`\n- Shell: bash\n\n### Services\n- systemd as PID 1 (init system)\n- sshd running on port 22\n- dockerd (for Docker-in-Docker)\n\n### Entrypoint\n- MUST NOT override ENTRYPOINT (systemd needs to be PID 1)\n- MUST NOT override CMD\n\n### Environment\n- PATH includes `/home/agent/.local/bin`\n- Standard development tools available\n\n## Recommended\n\n### AI Agents\n- Claude Code CLI at `/home/agent/.local/bin/claude`\n- Other agents as available\n\n### SDKs\n- Node.js with nvm\n- Python with uv/pipx\n- Go, Rust, .NET as needed\n\n## Validation\n\nContainAI validates base images by checking:\n1. Layer history includes `ghcr.io/novotnyllc/containai` or `containai:`\n2. If not found: WARN (not error) with explanation\n\nTo suppress warning:\n```toml\n[template]\nsuppress_base_warning = true\n```\n```\n\n## Tasks\n\n### fn-37-4xi.1: Create base-image-contract.md\nWrite comprehensive documentation covering all requirements.\n\n### fn-37-4xi.2: Add layer validation to template builds\nImplement warning when template doesn't derive from ContainAI image.\n\n### fn-37-4xi.3: Add config option for warning suppression\n`[template].suppress_base_warning = true` in config.toml.\n\n## Quick commands\n\n```bash\n# Check layer history\ndocker image history containai:latest\n\n# Verify required paths\ndocker run --rm containai:latest ls -la /home/agent /mnt/agent-data /opt/containai\n\n# Check user\ndocker run --rm containai:latest id agent\n```\n\n## Acceptance\n\n- [ ] `docs/base-image-contract.md` created\n- [ ] Document covers filesystem, user, services, entrypoint\n- [ ] Layer validation warns for non-ContainAI bases\n- [ ] Warning suppression config option works\n\n## Dependencies\n\n- **fn-35-e0x**: Agent Extensibility (establishes agent installation patterns)\n- All other epics should be complete\n\n## References\n\n- Docker image layers: https://docs.docker.com/storage/storagedriver/\n- systemd in containers: https://developers.redhat.com/blog/2019/04/24/how-to-run-systemd-in-a-container\n"
  },
  "epic_id": "fn-37-4xi",
  "schema_version": 2,
  "tasks": [
    {
      "data": {
        "assignee": null,
        "claim_note": "",
        "claimed_at": null,
        "created_at": "2026-01-28T19:11:22.550854Z",
        "depends_on": [],
        "epic": "fn-37-4xi",
        "id": "fn-37-4xi.1",
        "priority": 1,
        "spec_path": ".flow/tasks/fn-37-4xi.1.md",
        "status": "todo",
        "title": "Create base-image-contract.md",
        "updated_at": "2026-01-28T19:11:22.550864Z"
      },
      "id": "fn-37-4xi.1",
      "runtime": null,
      "spec": "# fn-37-4xi.1 Create base-image-contract.md\n\n## Description\nTBD\n\n## Acceptance\n- [ ] TBD\n\n## Done summary\nTBD\n\n## Evidence\n- Commits:\n- Tests:\n- PRs:\n"
    },
    {
      "data": {
        "assignee": null,
        "claim_note": "",
        "claimed_at": null,
        "created_at": "2026-01-28T19:11:22.618644Z",
        "depends_on": [],
        "epic": "fn-37-4xi",
        "id": "fn-37-4xi.2",
        "priority": 2,
        "spec_path": ".flow/tasks/fn-37-4xi.2.md",
        "status": "todo",
        "title": "Add layer validation to template builds",
        "updated_at": "2026-01-28T19:11:22.618655Z"
      },
      "id": "fn-37-4xi.2",
      "runtime": null,
      "spec": "# fn-37-4xi.2 Add layer validation to template builds\n\n## Description\nTBD\n\n## Acceptance\n- [ ] TBD\n\n## Done summary\nTBD\n\n## Evidence\n- Commits:\n- Tests:\n- PRs:\n"
    },
    {
      "data": {
        "assignee": null,
        "claim_note": "",
        "claimed_at": null,
        "created_at": "2026-01-28T19:11:22.683968Z",
        "depends_on": [],
        "epic": "fn-37-4xi",
        "id": "fn-37-4xi.3",
        "priority": 3,
        "spec_path": ".flow/tasks/fn-37-4xi.3.md",
        "status": "todo",
        "title": "Add config option for warning suppression",
        "updated_at": "2026-01-28T19:11:22.683979Z"
      },
      "id": "fn-37-4xi.3",
      "runtime": null,
      "spec": "# fn-37-4xi.3 Add config option for warning suppression\n\n## Description\nTBD\n\n## Acceptance\n- [ ] TBD\n\n## Done summary\nTBD\n\n## Evidence\n- Commits:\n- Tests:\n- PRs:\n"
    }
  ]
}
