# fn-18-g96.2 Add --container parameter to all workspace commands

## Description

Replace the existing `--name` parameter with `--container` for explicit container targeting. This provides a consistent interface across all workspace-aware commands.

**Commands to update:**
- `cai shell --container NAME` - Select existing container
- `cai run --container NAME` - Create with specific name
- `cai import --container NAME` - Target specific container
- `cai export --container NAME` - Export from specific container
- `cai stop --container NAME` - Stop specific container

**Note:** `cai links` retains `--name` as it has different semantics (specifying a name, not selecting an existing container).

**Changes needed:**
1. In each command's argument parsing, rename `--name` to `--container`
2. Update help text for each command
3. Remove any backward compatibility for `--name` on these commands
4. For `stop`, add container-specific targeting (currently uses selection prompt)

**Semantics:**
- `shell`: Container must exist and be ContainAI-managed; error otherwise
- `run`: Container must NOT exist; error if name collision
- `import/export`: Container must exist; workspace and data volume derived from labels
- `stop`: Container must exist; error otherwise

**Label-based resolution for import/export:**
When `--container NAME` is specified:
```bash
# Check for mutually exclusive flags
if [[ -n "$container_name" ]] && [[ -n "$workspace_path" ]]; then
    _cai_error "--container and --workspace are mutually exclusive"
    return 1
fi
if [[ -n "$container_name" ]] && [[ -n "$data_volume" ]]; then
    _cai_error "--container and --data-volume are mutually exclusive"
    return 1
fi

# Derive workspace from container labels
workspace_path=$(docker inspect --format '{{index .Config.Labels "containai.workspace"}}' "$container_name")
if [[ -z "$workspace_path" ]]; then
    _cai_error "Container $container_name is missing workspace label"
    return 1
fi

data_volume=$(docker inspect --format '{{index .Config.Labels "containai.data-volume"}}' "$container_name")
if [[ -z "$data_volume" ]]; then
    _cai_error "Container $container_name is missing data-volume label"
    return 1
fi
```

**Error messages:**
- Container not found: `[ERROR] Container not found: NAME`
- Not ContainAI-managed: `[ERROR] Container NAME exists but is not managed by ContainAI`
- Name collision on create: `[ERROR] Container NAME already exists`
- Missing labels:
  - `[ERROR] Container NAME is missing workspace label`
  - `[ERROR] Container NAME is missing data-volume label`
- Mutual exclusivity:
  - `[ERROR] --container and --workspace are mutually exclusive`
  - `[ERROR] --container and --data-volume are mutually exclusive`

## Acceptance

- [ ] `--container` parameter accepted on shell, run, import, export, stop
- [ ] `--name` parameter removed on shell, run, import, export, stop (no backward compat)
- [ ] `cai links` retains `--name` (different semantic)
- [ ] Help text updated for all commands
- [ ] Correct error messages for each failure mode
- [ ] `shell --container NAME` opens shell to specific container
- [ ] `run --container NAME` creates container with that name
- [ ] `stop --container NAME` stops only that container
- [ ] `import --container NAME` derives workspace/volume from labels
- [ ] `export --container NAME` derives workspace/volume from labels
- [ ] Error if container missing workspace label
- [ ] Error if container missing data-volume label
- [ ] Error if --container used with --workspace
- [ ] Error if --container used with --data-volume

## Done summary
Implemented --container parameter for all workspace commands (shell, run, import, export, stop). The parameter enables explicit container targeting with label-based workspace/volume derivation for import/export. Mutual exclusivity checks enforce --container cannot be combined with --workspace or --data-volume. The stop command provides a migration message for --name users; other commands show standard usage errors. The links command correctly retains --name for its different semantics. All changes passed 7 rounds of impl-review and shellcheck validation.
## Evidence
- Commits: 0a011b0, cc923bf, f168c65, 64d6712, bfd0fcc, 92ca4ed, 77a3170, 38de50b, 8e74b53, 8955caa
- Tests: shellcheck -x src/containai.sh, shellcheck -x src/lib/*.sh, cai stop --name test (verified migration message), cai run/shell/import/export --name (verified rejection), cai links --help (verified --name retained), cai stop --help (verified --container), cai import --help (verified --container), cai shell --help (verified --container), cai export --help (verified --container), cai run --help (verified --container)
- PRs:
