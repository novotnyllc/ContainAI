# fn-18-g96.1 cai shell auto-create and auto-start container

## Description

Ensure `cai shell` provides seamless container lifecycle management with the new naming and lookup conventions.

**Current state:**
- `_cai_ssh_shell` in `src/lib/ssh.sh` already handles auto-start of stopped containers
- `_containai_shell_cmd` calls into container creation logic that already auto-creates

**What needs updating:**
1. Integrate with new `_cai_find_workspace_container()` lookup helper (from epic spec)
2. Use new `_cai_resolve_container_name()` for container creation (repo-branch naming)
3. Ensure the lookup order is: label match → new name → legacy hash
4. Verify SSH setup happens correctly after container creation

**Key functions to update:**
- `_containai_shell_cmd` in `src/containai.sh` - use shared lookup helper
- Ensure container creation uses new naming from fn-18-g96.8

## Acceptance

- [ ] `cai shell` in a new workspace creates a container automatically
- [ ] Created container uses repo-branch naming (depends on fn-18-g96.8)
- [ ] `cai shell` with stopped container starts it (already works)
- [ ] Container has correct labels (containai.managed, containai.workspace)
- [ ] SSH setup completes after container creation
- [ ] Uses `_cai_find_workspace_container()` for existing container discovery
- [ ] Exit code 0 on success, non-zero on failure with clear error message

## Done summary
Implemented shared container lookup helpers for cai shell with proper lifecycle management. Added _cai_find_workspace_container() with distinct exit codes (0=found, 1=not found, 2=multiple matches), _cai_resolve_container_name() for duplicate-aware naming, and _containai_legacy_container_name() for backward compatibility. Updated _containai_shell_cmd to use these helpers with proper error handling and single-sourced naming.
## Evidence
- Commits: 801301b9ea20fec5638ce792b744fde680de32b9, 8e92d51f7b40845dda1496115b8d8662530463f9
- Tests: shellcheck -x src/lib/container.sh src/containai.sh, bash tests/unit/test-exclude-rewrite.sh
- PRs:
