# fn-16-4c9.2 macOS bash auto-install via Homebrew

## Description

On macOS, the system bash is 3.2 (GPLv2) while ContainAI requires bash 4.0+. The bootstrap must happen in `install.sh` BEFORE sourcing/creating the cai wrapper, since the wrapper and CLI use bash 4+ features.

**Why install.sh, not cai setup:**
- `install.sh` runs on bash 3.2 (compatible)
- The cai wrapper sources libs that require bash 4+ (e.g., `src/lib/ssh.sh`, `src/lib/uninstall.sh`)
- If we wait until `cai setup`, the wrapper fails to source on bash 3.2

**Important:** This task owns ALL flag parsing for install.sh. Other tasks (fn-16-4c9.3, fn-16-4c9.4) reference the parsed variables, they do NOT re-parse.

**Sequencing:**
1. Parse ALL flags FIRST (`--yes`, `--no-setup`)
2. THEN do bash bootstrap (respecting flag state)
3. THEN clone/update repo
4. THEN create wrapper
5. THEN run cai setup/update (fn-16-4c9.3/4)

**Flag-aware behavior:**
```
Piped install (no TTY on stdin):
- No --yes flag: NO prompts, NO bash install, show instructions only
- --yes flag: Auto-install bash (no prompts)

Interactive install (TTY on stdin):
- Prompt user for bash/Homebrew install
```

**What to implement:**

1. **Parse ALL flags at top of install.sh** (before bash bootstrap):
   ```bash
   # These variables are used by this task AND fn-16-4c9.3/4
   YES_FLAG=""
   NO_SETUP=""
   while [[ $# -gt 0 ]]; do
       case "$1" in
           --yes) YES_FLAG="1"; shift ;;
           --no-setup) NO_SETUP="true"; shift ;;
           *) shift ;;
       esac
   done
   ```

2. **Bash bootstrap with flag awareness:**
   - Check for existing Homebrew bash first
   - If --yes: auto-install without prompts
   - If interactive: prompt for install
   - If piped without --yes: show instructions only, continue without BASH4_PATH
   - Use direct brew path (`/opt/homebrew/bin/brew`) not PATH

3. **cai wrapper re-exec** (for future invocations):
   At top of wrapper, re-exec with Homebrew bash if running under bash 3.x

**Files to modify:**
- `install.sh`: Add flag parsing (used by this task and fn-16-4c9.3/4), bash bootstrap

## Acceptance
- [ ] install.sh parses --yes and --no-setup at TOP (before anything else)
- [ ] YES_FLAG and NO_SETUP variables available for fn-16-4c9.3/4
- [ ] Piped install without --yes: no prompts, no bash install, shows instructions
- [ ] Piped install with --yes: auto-installs bash (no prompts)
- [ ] Interactive install: prompts for bash/Homebrew install
- [ ] Uses direct brew path (`/opt/homebrew/bin/brew`) not PATH
- [ ] Works even if Homebrew not on PATH after installation
- [ ] Checks for existing Homebrew bash first
- [ ] Bootstrap happens BEFORE cai wrapper is created
- [ ] Post-install cai commands use detected $BASH4_PATH
- [ ] cai wrapper re-execs with Homebrew bash if under bash 3.x

## Done summary
Implemented macOS bash 4+ auto-install via Homebrew in install.sh. The script now parses --yes and --no-setup flags at the top, bootstraps bash 4+ before creating the cai wrapper, and the wrapper auto-re-execs with Homebrew bash when running under bash 3.x.
## Evidence
- Commits: e6971c6, 0d919c9
- Tests: shellcheck -x install.sh, bash -n install.sh
- PRs:
