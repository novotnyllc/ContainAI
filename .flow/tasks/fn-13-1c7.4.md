# fn-13-1c7.4 Evaluate direct JSON parsing approach

## Description
Evaluate parsing devcontainer.json directly with jq/Python, building container configuration from scratch. Analyze complexity, spec compliance risks, and maintenance burden.

**Size:** M
**Files:** Output to `.flow/research/fn-13-1c7/option-direct-parsing.md`

## Approach

1. Document minimum viable parsing requirements:
   - Which properties must ContainAI understand?
   - Which can be safely ignored?
2. Analyze JSONC parsing challenge (devcontainer.json supports comments)
   - Option: Strip comments then jq (fragile?)
   - Option: Python json5/hjson library
   - Option: Custom comment stripper in bash
3. Document spec compliance risks:
   - Variable expansion (`${localWorkspaceFolder}`, etc.)
   - Feature merging algorithm
   - Config file precedence rules
4. **Document build handling explicitly**:
   - How to obtain final image (pull vs build)?
   - Where does build execute (host vs DinD inside Sysbox)?
   - Feature installation: allowed? allowlist? sandbox?
   - Supply-chain risk handling (digest pinning, allowlist)
5. **Document discovery and multi-config selection**:
   - `.devcontainer/devcontainer.json` vs `.devcontainer/<name>/devcontainer.json`
   - Precedence rules
   - UX for "choose devcontainer" (link to fn-12-css workspace state)
6. Estimate maintenance burden for tracking spec changes

## Key context

ContainAI already has:
- TOML parsing via `parse-toml.py`
- JSON parsing via `jq` (hard dependency)
- Config file discovery via `_containai_find_config()`

These could be extended for devcontainer.json parsing.

## Acceptance
- [ ] Minimum viable property set documented
- [ ] JSONC parsing solution identified and justified
- [ ] Variable expansion requirements analyzed
- [ ] Feature merging complexity assessed
- [ ] **Build handling documented**: image acquisition, build location, feature control
- [ ] **Discovery rules documented**: multi-config, precedence, UX
- [ ] Maintenance burden estimate provided
- [ ] Pros/cons table vs CLI wrapping

## Done summary
Evaluated direct JSON parsing approach for devcontainer support:

- Documented minimum viable property set (9 properties cover 95% of repos)
- Analyzed JSONC parsing: recommend strip+jq with json5 fallback
- Assessed variable expansion: 5 common variables, implementable in 1-2 days
- Feature merging: Full implementation is 2-4 weeks - recommend allowlist approach
- Build handling: DinD inside Sysbox, allowlist official features
- Discovery rules: 3 locations, multi-config UX documented
- Maintenance burden: 12-23 days/year vs 2-5 for CLI wrapping
- Provided pros/cons table vs CLI wrapping
- Recommended hybrid approach: direct parsing for simple configs, CLI fallback for complex
## Evidence
- Commits:
- Tests:
- PRs:
