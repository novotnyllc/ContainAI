# fn-3-8m1.5 Update entrypoint.sh with ensure_volume_structure

## Description
Update `ensure_volume_structure()` to create all SYNC_MAP targets (spec lines 420-491).

**Principle**: Sync is optional, so entrypoint MUST ensure all paths exist.

**Paths to ensure** (derived from SYNC_MAP):
- Claude Code: mkdir claude/, init JSON files, mkdir plugins/, skills/
- GitHub CLI: mkdir config/gh/, chmod 700
- Copilot: mkdir copilot/skills/, touch config.json, mcp-config.json
- OpenCode: mkdir local/share/opencode/, touch auth.json, chmod 600
- tmux: mkdir tmux/, touch .tmux.conf, mkdir .tmux/, config/tmux/
- Shell: mkdir shell/, touch .bash_aliases, mkdir .bashrc.d/
- VS Code Server: mkdir extensions/, data/Machine/, data/User/mcp/, data/User/prompts/
- VS Code Insiders: same structure
- Gemini: mkdir gemini/, touch credentials, chmod 600
- Codex: mkdir codex/skills/, touch files, chmod 600 on auth.json

**Final step**: `chown -R 1000:1000 /mnt/agent-data`
## Acceptance
- [ ] All SYNC_MAP target directories created
- [ ] JSON files initialized with {} where flagged
- [ ] Secret files have chmod 600
- [ ] Secret dirs have chmod 700
- [ ] Ownership set to 1000:1000
- [ ] Container starts without broken symlinks
## Done summary
Implemented ensure_volume_structure() in entrypoint.sh with comprehensive security hardening: symlink traversal protection using realpath -m, type validation for all paths, sudo -n for fail-fast non-interactive mode, safe_chmod helper, and is_mountpoint guard for workspace replacement. All SYNC_MAP target directories and files are created with proper permissions (600 for secrets, 700 for secret dirs).
## Evidence
- Commits: a5a3a3c, a9170cc, 4c5396c, 8d23235, e6a6935, 20b49d2, ca86a8f, 155d6e5
- Tests: bash -n agent-sandbox/entrypoint.sh
- PRs:
