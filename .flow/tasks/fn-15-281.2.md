# fn-15-281.2 Add dockerd bundle installation to setup.sh

## Description
Add dockerd bundle installation to `cai setup` for Linux/WSL2 using versioned directories and symlinks for atomic updates.

**Size:** M
**Files:** `src/lib/setup.sh`, `src/lib/update.sh`

## Approach

### Preflight change
Remove the requirement for system `dockerd` from `_cai_setup_linux()` preflight checks. The bundle will provide dockerd, so `command -v dockerd` should not be required before bundle installation.

### Add `_cai_install_dockerd_bundle()` function
1. Detect architecture using pattern at line 528-542 (map to Docker's arch names: x86_64, aarch64)
2. Resolve latest version by parsing Docker index HTML at `https://download.docker.com/linux/static/stable/<arch>/`
3. Download `docker-<version>.tgz` with `wget -q --connect-timeout=5 --timeout=120` (wget is already ensured for Sysbox install)
4. **Extraction:** Extract to temp dir, then move `temp/docker/*` to `/opt/containai/docker/<version>/` (Docker tarballs extract with docker/ subdir)
5. Create symlinks in `/opt/containai/bin/`:
   - `dockerd -> ../docker/<version>/dockerd`
   - `docker -> ../docker/<version>/docker`
   - `containerd -> ../docker/<version>/containerd`
   - `containerd-shim-runc-v2 -> ../docker/<version>/containerd-shim-runc-v2`
   - `docker-init -> ../docker/<version>/docker-init`
   - `docker-proxy -> ../docker/<version>/docker-proxy`
   - `runc -> ../docker/<version>/runc`
   - `ctr -> ../docker/<version>/ctr`
6. Write version to `/opt/containai/VERSION`

Use `ln -sfn` for atomic symlink creation/update.

Call from Linux/WSL2 setup path. Skip on macOS (uses Lima VM).

### Systemd unit template
Create shared function `_cai_dockerd_unit_content()` that generates the unit file content. Both `setup.sh` and `update.sh` must use this same function to avoid drift:
- `ExecStart=/opt/containai/bin/dockerd --config-file=/etc/containai/docker/daemon.json`
- `Environment=PATH=/opt/containai/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin`

Update `_cai_create_isolated_docker_service()` to use this shared function.

**Critical:** Also update `_cai_update_expected_unit_content()` in `update.sh` to use the same shared function or identical content.

## Key context

- Docker does NOT provide checksum filesâ€”trust HTTPS only
- Docker tarballs extract to `docker/` subdir, must move contents
- Follow download pattern at `src/lib/setup.sh:557-601`
- Use `_cai_timeout` wrapper from `docker.sh:49-97` for portable timeout
- `ln -sfn` replaces symlink atomically (no intermediate broken state)
- `wget` is already ensured by Sysbox install dependency
- PATH env in unit ensures bundled containerd/runc are used by dockerd

## Acceptance
- [ ] `_cai_install_dockerd_bundle` function added
- [ ] Downloads from Docker static index using `wget`
- [ ] Extracts to temp dir, moves docker/* contents to /opt/containai/docker/<version>/
- [ ] Creates symlinks in /opt/containai/bin/ for all bundle binaries
- [ ] Symlinks use relative paths (../docker/<version>/...)
- [ ] Writes VERSION file to /opt/containai/VERSION
- [ ] Preflight no longer requires system dockerd
- [ ] containai-docker.service ExecStart uses /opt/containai/bin/dockerd
- [ ] containai-docker.service has Environment=PATH=/opt/containai/bin:...
- [ ] Unit content shared between setup.sh and update.sh (no drift)
- [ ] Skipped on macOS
- [ ] shellcheck passes

## Done summary
Added `_cai_install_dockerd_bundle()` function to download and install Docker static binaries from download.docker.com to /opt/containai/. Creates versioned directories with symlinks for atomic updates. Updated systemd unit to use bundled dockerd with PATH environment variable. Shared unit template function ensures setup.sh and update.sh stay in sync.
## Evidence
- Commits: 5ea6601, 6519b69, 6277852, 7847ba6
- Tests: shellcheck -x src/lib/docker.sh src/lib/setup.sh src/lib/update.sh
- PRs:
