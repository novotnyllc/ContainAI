# fn-15-281.2 Add dockerd bundle installation to setup.sh

## Description
Add dockerd bundle installation to `cai setup` for Linux/WSL2 using versioned directories and symlinks for atomic updates.

**Size:** M
**Files:** `src/lib/setup.sh`

## Approach

Add `_cai_install_dockerd_bundle()` function:
1. Detect architecture using pattern at line 528-542 (map to Docker's arch names: x86_64, aarch64)
2. Resolve latest version by parsing Docker index HTML at `https://download.docker.com/linux/static/stable/<arch>/`
3. Download `docker-<version>.tgz` with `curl -fsSL --connect-timeout 5 --max-time 120`
4. Extract to `/opt/containai/docker/<version>/`
5. Create symlinks in `/opt/containai/bin/`:
   - `dockerd -> ../docker/<version>/dockerd`
   - `docker -> ../docker/<version>/docker`
   - `containerd -> ../docker/<version>/containerd`
   - (and other binaries in the bundle)
6. Write version to `/opt/containai/VERSION`

Use `ln -sfn` for atomic symlink creation/update.

Call from Linux/WSL2 setup path. Skip on macOS (uses Lima VM).

Modify `_cai_create_isolated_docker_service()` to use `$_CAI_DOCKERD_BIN` (the symlinked path).

## Key context

- Docker does NOT provide checksum files—trust HTTPS only
- Follow download pattern at `src/lib/setup.sh:557-601`
- Use `_cai_timeout` wrapper from `docker.sh:49-97` for portable timeout
- `ln -sfn` replaces symlink atomically (no intermediate broken state)
## Approach

Add `_cai_install_dockerd_bundle()` function:
1. Detect architecture using pattern at line 528-542 (map to Docker's arch names: x86_64, aarch64)
2. Resolve latest version by parsing Docker index HTML at `https://download.docker.com/linux/static/stable/<arch>/`
3. Download `docker-<version>.tgz` with `curl -fsSL --connect-timeout 5 --max-time 120`
4. Extract to temp dir, verify dockerd binary exists
5. Move to `/opt/containai/docker/` with sudo (root-owned, 0755)
6. Write version to `/opt/containai/docker/VERSION`

Call from Linux/WSL2 setup path. Skip on macOS (uses Lima VM).

Modify `_cai_create_isolated_docker_service()` to use `$_CAI_DOCKERD_BIN` in ExecStart.

## Key context

- Docker does NOT provide checksum files—trust HTTPS only
- Follow download pattern at `src/lib/setup.sh:557-601`
- Use `_cai_timeout` wrapper from `docker.sh:49-97` for portable timeout
## Acceptance
- [ ] `_cai_install_dockerd_bundle` function added
- [ ] Downloads from Docker static index
- [ ] Extracts to /opt/containai/docker/<version>/
- [ ] Creates symlinks in /opt/containai/bin/
- [ ] Symlinks use relative paths (../docker/<version>/...)
- [ ] Writes VERSION file to /opt/containai/VERSION
- [ ] containai-docker.service ExecStart uses /opt/containai/bin/dockerd
- [ ] Skipped on macOS
- [ ] shellcheck passes
## Done summary
TBD

## Evidence
- Commits:
- Tests:
- PRs:
