# Add Mac support for import scripts

## Overview

Enable `cai import` to work on macOS. The import script syncs host configs (Claude plugins, gh credentials, tmux, shell, etc.) to a Docker volume for use inside the sandbox container.

**Current state**: Documentation says "Linux/WSL only - macOS is not yet supported" (README.md:54).

**Finding**: The import.sh code is already largely portable:
- Base64 encoding uses `base64 | tr -d '\n'` (portable)
- POSIX sh code runs inside Linux container (no host compatibility issue)
- Platform detection already exists (`_cai_detect_platform()` in lib/platform.sh)

**Remaining work**:
1. Update README documentation to indicate Mac support
2. Add Mac-specific integration tests to verify the import works
3. Handle edge case: VS Code desktop settings (macOS uses `~/Library/Application Support/Code/`)

## Scope

**In scope**:
- Update documentation to indicate Mac support
- Add tests to verify `cai import` works on macOS
- Fix any edge cases discovered during testing

**Out of scope**:
- VS Code desktop settings sync (different paths per OS - handled by existing sync-vscode.sh scripts)
- Adding new import sources not already in `_IMPORT_SYNC_MAP`

## Approach

The `_IMPORT_SYNC_MAP` array in import.sh uses `$HOME`-relative paths that work on macOS:
- `~/.claude/` - Claude CLI (same on all platforms)
- `~/.config/gh/` - GitHub CLI (follows XDG on macOS)
- `~/.config/tmux/` - tmux (XDG)
- `~/.vscode-server/` - VS Code Remote Server (same on all platforms)
- etc.

Since these paths are consistent across Linux and macOS, the main work is:
1. Verify with tests
2. Update documentation

## Quick commands

```bash
# Test import on macOS (manual)
source ./containai.sh
cai import --dry-run

# Run the new integration tests
./agent-sandbox/tests/test-import-mac.sh
```

## Acceptance

- [ ] README.md updated to indicate Mac support for `cai import`
- [ ] Integration test for `cai import` on macOS (can be skipped on non-Mac CI)
- [ ] `cai import --dry-run` works on macOS without errors
- [ ] No regressions on Linux/WSL

## References

- `agent-sandbox/lib/import.sh:88-146` - `_IMPORT_SYNC_MAP` array with source paths
- `agent-sandbox/lib/import.sh:292-293` - Portable base64 encoding
- `agent-sandbox/lib/platform.sh:42-85` - Platform detection helpers
- `agent-sandbox/README.md:54` - Current "Linux/WSL only" documentation
- [GitHub CLI uses ~/.config/gh/ on macOS](https://cli.github.com/manual/gh_config)
