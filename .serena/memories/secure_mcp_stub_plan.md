## Secure MCP Stub Execution Plan (Nov 17 2025)
1. **Stub Helper**: Add broker-enforced MCP stub (likely bash/python) installed into agent images. Stub will accept server alias, capability file path, and broker socket/env, then redeem capability via `secret-broker.py` before exec-ing the real MCP binary. Fail closed if capability missing/invalid.
2. **Renderer/Launcher Flow**: Update `render-session-config.py` plus launcher scripts so `[mcp_servers.*]` commands reference the stub instead of raw MCP binaries. Launcher is responsible for issuing a capability per server via broker, writing the sealed capability file into the container mount, and wiring stub args (broker socket, capability path, downstream command).
3. **Fallback Removal**: Delete the entrypoint fallback to `setup-mcp-configs.sh`; container must exit if session configs are absent or invalid. Keep the conversion script only for manual debugging paths.
4. **Tests & Docs**: Extend launcher/unit tests (bash + PowerShell) to assert stub usage and absence of fallbacks. Update `docs/mcp-setup.md`, `docs/secret-broker-architecture.md`, and any runtime docs to describe the new flow and stub responsibilities.