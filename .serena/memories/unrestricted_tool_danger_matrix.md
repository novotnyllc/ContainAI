# Tool Danger Matrix

| Tool / Action | What it does | Required Privileges | Destructive Risk | Exfiltration Risk | Prompt-Injection Risk | Recommended Mitigation / Tier |
| --- | --- | --- | --- | --- | --- | --- |
| Serena edit / file write (MCP + `apply_patch`) | Modifies files under `/workspace` | Write access to repo copy | Medium (can delete files but revertible via git snapshot) | Low (no network) | Medium (malicious prompts can change security configs) | **Tier 1** — Allow silently but log diffs to host; auto-snapshot before large patch.
| Shell command execution (`agent-session`, VS Code terminal) | Runs arbitrary commands inside container | Processes, FS, network | High (can wipe repo, install persistence) | High (curl/wget) | High | **Tier 2** — Route through safe shell wrapper restricting path writes and auto-logging commands; throttle network-heavy commands unless allowlisted.
| Git operations to `local` remote (default push) | Syncs workspace branch to host bare repo | Git credential proxy / PAT | Medium (branch-only) | Medium (branch can carry secrets) | Medium | **Tier 2** — Silent, but enforce pre-push hooks (secret scanner) and auto-branch naming; no prompt needed.
| Git push/pull to `origin` / other remotes | Publishes changes to GitHub or fetches new code | GitHub token | High (can leak secrets, tamper remote repos) | High | High | **Tier 3** — Require explicit user confirmation per command or block entirely in unrestricted mode unless repo allowlist satisfied.
| MCP `fetch` / generic HTTP client | Fetches arbitrary URLs, can send data | Network access | Low direct | High (can POST secrets) | High | **Tier 3** — Disable or proxy through audited fetch service with domain allowlist; require prompt for new domains.
| Package manager install (npm/pip/apt) | Installs dependencies within container | Root or sudo? (apt requires root) | Medium (can drop trojans) | Medium | High (scripts run on install) | **Tier 2** — Allow silently but run inside sanitized environment; log package names and versions; optionally require extra confirmation when installing from non-registry sources.
| Network access via Squid proxy | HTTP/HTTPS to allowlisted domains | Proxy credentials | Low direct | Medium (still can upload to GitHub Gists, etc.) | Medium | **Tier 1.5** — Silent but log every request + enforce domain-level quotas.
| SSH agent forwarding | Uses host SSH keys for git/remote shells | SSH_AUTH_SOCK mount | Medium (can push to other repos) | High (remote shells) | High | **Tier 3** — Wrap with host policy that restricts endpoints; prompt before first non-origin host use.
| Secrets broker access (proposed) | Mint scoped tokens | Host broker | Medium | High if misused | High | **Tier 3** — Broker requires OTP or host confirmation when new scopes requested; no prompts for renewals within same scope.
| Container resource override flags (`--cpu`, `--memory`, `--gpu`) | Adjusts runtime caps | Launch scripts | Low | Low | Low | **Tier 1** — Controlled by user-specified CLI; no prompts.
